{% block content %}


{% set tags = craft.entries()
    .section('tagg')
    .limit(22)
    .orderBy('dateCreated DESC')
    .all() %}




{% if tags is defined and tags|length %}
    <form method="post" accept-charset="UTF-8" enctype="multipart/form-data">
        {{ csrfInput() }}
        {{ actionInput('guest-entries/save') }}
        {{ hiddenInput('sectionId', 16) }}
        
        {# Champ caché pour lier l'entrée à l'utilisateur actuel #}
        {% if user is defined and user %}
            {{ hiddenInput('fields[gens][]', user.id) }}
        {% endif %}

        {# 1. Champ de sélection pour les TAGS #}
        {# Champ de sélection pour les TAGS sous forme de boutons #}
        <div class="mb-3">
            <label class="form-label">Choisissez un Projet :</label>
            <div class="d-flex flex-wrap gap-2">
                <button onclick="addoneTAG()" class="btn btn-outline-danger">
                    + Ajoutez un Projet
                </button>

                
                {% for tag in tags %}
                    {# 
                    Chaque "bouton" est une paire d'un input radio caché 
                    et d'un label stylisé en bouton.
                    #}
                    <input 
                        type="radio" 
                        class="btn-check" 
                        name="fields[tagg][]" 
                        id="tag-{{ tag.id }}" 
                        value="{{ tag.id }}"
                        autocomplete="off"
                        required
                        data-title="{{ tag.title|e('html_attr') }}"
                    >
                    <label class="btn btn-outline-secondary" for="tag-{{ tag.id }}">{{ tag.title }}</label>
                {% endfor %}
            </div>
        </div>

        {# 2. Champ pour le TITRE #}
        <div class="mb-3">
            <label for="title" class="form-label">Pourquoi ce projet ?</label>
            <input id="title" type="text" name="title" class="form-control" required placeholder="Quel est votre Motivation ?">
        </div>

        {# 3. Champ pour l'HEURE #}
        <div class="mb-3">
            <label for="horaire-select" class="form-label">Horaire d'Effort Récurrent :</label>
            <select id="horaire-select" name="fields[dt]" class="form-select" required>
                {% set startHour = now|date('G', 'Europe/Paris') %}
                {% for i in 0..23 %}
                    {% set currentHour = (startHour + i) % 24 %}
                    {% set hourString = currentHour|format('%02d') %}
                    <option value="{{ hourString }}:00">{{ hourString }}h</option>
                {% endfor %}
            </select>
        </div>

        <button type="submit" class="btn btn-danger btn-lg d-inline-flex align-items-center">Ajouter le Projet</button>
    </form>
{% else %}
    <p>Aucun Projet n'est disponible pour le moment.</p>
    <br>
    <button onclick="addoneTAG()" class="btn btn-outline-danger">
        + Ajoutez un Projet
    </button>
{% endif %}

{% endblock %}